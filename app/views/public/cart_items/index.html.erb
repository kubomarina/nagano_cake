<div class="container">
  <h4>ショッピングカート</h4>
   <div class="row">
    <div class="col-12">
     <div class="float-right">
      <%= link_to cart_items_destroy_all_path, method: :delete do%>
      <i class="btn btn-danger">カートを空にする</i>
      <% end %>
     </div>
   </div>
  </div>

<table class="table table-bordered">
 <thead class="thead-light">
  <tr>
    <th>商品名</th>
    <th>単価(税込)</th>
    <th>数量</th>
    <th>小計</th>
    <th></th>
  </tr>
 </thead>
  <% @sum = 0 %>
  <% @cart_items.each do |cart_item| %>
  <tr>
    <td>
     <%= attachment_image_tag cart_item.item, :image, :fill, 40, 35, format: 'jpeg', fallback: "no_image.jpg", size:'40×35' %>
     <%= cart_item.item.name %>
    </td>
    <td><%= (cart_item.item.price*1.1).round %></td>
     <%= form_with model:cart_item, url: cart_item_path(cart_item), method: :patch,local:true do |f| %>
    <td>
     <%= f.select :amount, options_for_select((1..20).to_a, cart_item.amount)%>
     <%= f.hidden_field :item_id %>
     <button class="btn btn-success" type="submit">更新</button>
    </td>
    <% end %>

    <td>
     <%= (cart_item.item.price*1.1*cart_item.amount).round %>
     <% @sum += (cart_item.item.price*1.1 * cart_item.amount).round %>
    </td>
    <td>
     <%= link_to cart_item_path(cart_item), method: :delete do %>
     <i class = "btn btn-danger">削除する</i>
     <% end %>
    </td>
  </tr>
  <% end %>
 </table>

<div class="row">
 <div class="col-12">
 <div class="float-left">
  <%= link_to root_path do %>
  <i class = "btn btn-primary">買い物を続ける</i>
  <% end %>
 </div>
 </div>
</div>

 <div class="col-12">
  <div class="float-right">
   <table class="table-bordered">
    <thead class="thead-light">
     <tr>
      <th>合計金額</th>
      <td><%= @sum %>円</td>
     </tr>
    </thead>
   </table>
  </div>
 </div>

<div class ="row">
  <div class="mx-auto">
   <%= link_to new_order_path do %>
   <i class = "btn btn-success">情報入力に進む</i>
   <% end %>
  </div>
 </div>
</div>
</div>